<!--pages/detection/result.wxml-->
<view class="page">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <navigation-bar title="æ£€æµ‹ç»“æœ" show-back="{{true}}"></navigation-bar>

  <!-- æ£€æµ‹ç»“æœå¡ç‰‡ -->
  <view class="result-card">
    <!-- é£Ÿå“å›¾ç‰‡ -->
    <view class="food-image-container">
      <image src="{{resultData.image}}" mode="aspectFit" class="food-image"></image>
      <view class="confidence-badge">
        <text class="confidence-text">ç½®ä¿¡åº¦ {{Math.round(resultData.confidence * 100)}}%</text>
      </view>
    </view>

    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="basic-info">
      <view class="food-name">{{resultData.foodName}}</view>
      <view class="detection-time">æ£€æµ‹æ—¶é—´: {{resultData.detectionTime}}</view>
    </view>

    <!-- å®‰å…¨è¯„çº§ -->
    <view class="safety-rating">
      <view class="rating-header">
        <view class="rating-icon {{resultData.safetyLevel}}">{{getSafetyIcon(resultData.safetyLevel)}}</view>
        <view class="rating-info">
          <view class="rating-title">{{getSafetyTitle(resultData.safetyLevel)}}</view>
          <view class="rating-subtitle">å®‰å…¨è¯„åˆ†: {{resultData.safetyScore}}/100</view>
        </view>
      </view>
      
      <view class="score-bar">
        <view class="score-fill {{resultData.safetyLevel}}" style="width: {{resultData.safetyScore}}%"></view>
      </view>
    </view>
  </view>

  <!-- è¯¦ç»†æ£€æµ‹ç»“æœ -->
  <view class="details-section">
    <view class="section-header">
      <view class="section-title">è¯¦ç»†æ£€æµ‹ç»“æœ</view>
    </view>
    
    <view class="details-grid">
      <view class="detail-item">
        <view class="detail-icon">ğŸŒ±</view>
        <view class="detail-content">
          <view class="detail-label">æ–°é²œåº¦</view>
          <view class="detail-value">{{resultData.details.freshness}}</view>
        </view>
      </view>
      
      <view class="detail-item">
        <view class="detail-icon">ğŸ§ª</view>
        <view class="detail-content">
          <view class="detail-label">å†œè¯æ®‹ç•™</view>
          <view class="detail-value">{{resultData.details.pesticide}}</view>
        </view>
      </view>
      
      <view class="detail-item">
        <view class="detail-icon">ğŸ¦ </view>
        <view class="detail-content">
          <view class="detail-label">ç»†èŒæ£€æµ‹</view>
          <view class="detail-value">{{resultData.details.bacteria}}</view>
        </view>
      </view>
      
      <view class="detail-item">
        <view class="detail-icon">ğŸ’Š</view>
        <view class="detail-content">
          <view class="detail-label">è¥å…»æˆåˆ†</view>
          <view class="detail-value">{{resultData.details.nutrition}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- å»ºè®®ä¸æé†’ -->
  <view class="suggestions-section">
    <view class="section-header">
      <view class="section-title">é£Ÿç”¨å»ºè®®</view>
    </view>
    
    <view class="suggestions-list">
      <view wx:for="{{resultData.suggestions}}" wx:key="index" class="suggestion-item">
        <view class="suggestion-icon">ğŸ’¡</view>
        <view class="suggestion-text">{{item}}</view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="action-btn secondary" bindtap="shareResult">
      <text class="btn-icon">ğŸ“¤</text>
      åˆ†äº«ç»“æœ
    </button>
    
    <button class="action-btn secondary" bindtap="saveToAlbum">
      <text class="btn-icon">ğŸ’¾</text>
      ä¿å­˜å›¾ç‰‡
    </button>
    
    <button class="action-btn primary" bindtap="detectAgain">
      <text class="btn-icon">ğŸ”</text>
      å†æ¬¡æ£€æµ‹
    </button>
  </view>

  <!-- ç›¸å…³æ¨è -->
  <view class="recommendations-section">
    <view class="section-header">
      <view class="section-title">ç›¸å…³æ¨è</view>
    </view>
    
    <scroll-view scroll-x class="recommendations-scroll">
      <view class="recommendations-list">
        <view wx:for="{{recommendations}}" wx:key="id" class="recommendation-card" bindtap="viewRecommendation" data-item="{{item}}">
          <image src="{{item.image}}" class="recommendation-image"></image>
          <view class="recommendation-content">
            <view class="recommendation-title">{{item.title}}</view>
            <view class="recommendation-desc">{{item.description}}</view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ä¸“å®¶ç‚¹è¯„ -->
  <view wx:if="{{expertComment}}" class="expert-section">
    <view class="section-header">
      <view class="section-title">ä¸“å®¶ç‚¹è¯„</view>
    </view>
    
    <view class="expert-card">
      <view class="expert-header">
        <image src="{{expertComment.avatar}}" class="expert-avatar"></image>
        <view class="expert-info">
          <view class="expert-name">{{expertComment.name}}</view>
          <view class="expert-title">{{expertComment.title}}</view>
        </view>
      </view>
      
      <view class="expert-content">
        <text class="expert-text">{{expertComment.content}}</text>
      </view>
    </view>
  </view>

  <!-- ä¸¾æŠ¥é—®é¢˜ -->
  <view class="report-section">
    <view class="report-hint">æ£€æµ‹ç»“æœæœ‰è¯¯ï¼Ÿ</view>
    <button class="report-btn" bindtap="reportIssue">
      <text class="report-icon">ğŸ“¢</text>
      ä¸¾æŠ¥é—®é¢˜
    </button>
  </view>
</view>

<!-- åˆ†äº«å¼¹çª— -->
<view wx:if="{{showShareModal}}" class="modal-overlay" bindtap="hideShareModal">
  <view class="share-modal" catchtap="">
    <view class="modal-header">
      <view class="modal-title">åˆ†äº«æ£€æµ‹ç»“æœ</view>
      <view class="modal-close" bindtap="hideShareModal">Ã—</view>
    </view>
    
    <view class="share-options">
      <view class="share-option" bindtap="shareToFriend">
        <view class="share-icon">ğŸ‘¥</view>
        <view class="share-text">åˆ†äº«ç»™æœ‹å‹</view>
      </view>
      
      <view class="share-option" bindtap="shareToMoments">
        <view class="share-icon">ğŸŒŸ</view>
        <view class="share-text">åˆ†äº«åˆ°æœ‹å‹åœˆ</view>
      </view>
      
      <view class="share-option" bindtap="copyLink">
        <view class="share-icon">ğŸ”—</view>
        <view class="share-text">å¤åˆ¶é“¾æ¥</view>
      </view>
    </view>
  </view>
</view>