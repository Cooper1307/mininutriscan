<view class="page">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <navigation-bar title="é£Ÿå“ç™¾ç§‘" show-back="{{true}}"></navigation-bar>

  <!-- æœç´¢åŒºåŸŸ -->
  <view class="search-section">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input class="search-input" 
             placeholder="æœç´¢é£Ÿå“åç§°" 
             value="{{searchKeyword}}" 
             bindinput="onSearchInput" 
             bindconfirm="onSearchConfirm" />
      <text class="search-clear" wx:if="{{searchKeyword}}" bindtap="onSearchClear">âœ•</text>
    </view>
    
    <view class="search-suggestions" wx:if="{{searchSuggestions.length > 0 && searchKeyword}}">
      <view class="suggestion-item" 
            wx:for="{{searchSuggestions}}" 
            wx:key="id" 
            bindtap="onSuggestionTap" 
            data-item="{{item}}">
        <text class="suggestion-icon">{{item.icon}}</text>
        <text class="suggestion-name">{{item.name}}</text>
        <text class="suggestion-category">{{item.category}}</text>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»å¯¼èˆª -->
  <view class="category-section" wx:if="{{!searchKeyword}}">
    <scroll-view class="category-scroll" scroll-x>
      <view class="category-list">
        <view class="category-item {{currentCategory === item.id ? 'active' : ''}}" 
              wx:for="{{categories}}" 
              wx:key="id" 
              bindtap="onCategoryTap" 
              data-category="{{item}}">
          <text class="category-icon">{{item.icon}}</text>
          <text class="category-name">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ¨èé£Ÿå“ -->
  <view class="recommend-section" wx:if="{{!searchKeyword && currentCategory === 'all'}}">
    <view class="section-header">
      <text class="section-title">æ¨èé£Ÿå“</text>
      <text class="section-more" bindtap="onViewMore">æŸ¥çœ‹æ›´å¤š</text>
    </view>
    
    <scroll-view class="recommend-scroll" scroll-x>
      <view class="recommend-list">
        <view class="recommend-item" 
              wx:for="{{recommendFoods}}" 
              wx:key="id" 
              bindtap="onFoodTap" 
              data-food="{{item}}">
          <image class="recommend-image" src="{{item.image}}" mode="aspectFill"></image>
          <view class="recommend-info">
            <text class="recommend-name">{{item.name}}</text>
            <text class="recommend-benefit">{{item.benefit}}</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- é£Ÿå“åˆ—è¡¨ -->
  <view class="foods-section">
    <view class="section-header" wx:if="{{!searchKeyword}}">
      <text class="section-title">{{currentCategoryName}}</text>
      <text class="section-count">({{filteredFoods.length}}ç§)</text>
    </view>
    
    <view class="section-header" wx:else>
      <text class="section-title">æœç´¢ç»“æœ</text>
      <text class="section-count">({{filteredFoods.length}}ä¸ª)</text>
    </view>
    
    <view class="foods-grid" wx:if="{{filteredFoods.length > 0}}">
      <view class="food-item" 
            wx:for="{{filteredFoods}}" 
            wx:key="id" 
            bindtap="onFoodTap" 
            data-food="{{item}}">
        <image class="food-image" src="{{item.image}}" mode="aspectFill"></image>
        <view class="food-info">
          <text class="food-name">{{item.name}}</text>
          <text class="food-category">{{item.category}}</text>
          <view class="food-tags">
            <text class="food-tag" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
          </view>
        </view>
        <view class="food-nutrition">
          <text class="nutrition-label">è¥å…»ä»·å€¼</text>
          <view class="nutrition-bar">
            <view class="nutrition-fill" style="width: {{item.nutritionScore}}%"></view>
          </view>
          <text class="nutrition-score">{{item.nutritionScore}}</text>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ”</text>
      <text class="empty-text">{{searchKeyword ? 'æœªæ‰¾åˆ°ç›¸å…³é£Ÿå“' : 'æš‚æ— é£Ÿå“ä¿¡æ¯'}}</text>
      <text class="empty-tip">{{searchKeyword ? 'è¯•è¯•å…¶ä»–å…³é”®è¯' : 'æ•¬è¯·æœŸå¾…æ›´å¤šå†…å®¹'}}</text>
    </view>
  </view>

  <!-- çƒ­é—¨æœç´¢ -->
  <view class="hot-search-section" wx:if="{{!searchKeyword}}">
    <view class="section-header">
      <text class="section-title">çƒ­é—¨æœç´¢</text>
    </view>
    
    <view class="hot-tags">
      <text class="hot-tag" 
            wx:for="{{hotSearches}}" 
            wx:key="*this" 
            bindtap="onHotSearchTap" 
            data-keyword="{{item}}">{{item}}</text>
    </view>
  </view>

  <!-- è¥å…»å°è´´å£« -->
  <view class="tips-section" wx:if="{{!searchKeyword}}">
    <view class="section-header">
      <text class="section-title">è¥å…»å°è´´å£«</text>
      <text class="section-more" bindtap="onViewAllTips">æŸ¥çœ‹æ›´å¤š</text>
    </view>
    
    <view class="tips-list">
      <view class="tip-item" 
            wx:for="{{nutritionTips}}" 
            wx:key="id" 
            bindtap="onTipTap" 
            data-tip="{{item}}">
        <text class="tip-icon">{{item.icon}}</text>
        <view class="tip-content">
          <text class="tip-title">{{item.title}}</text>
          <text class="tip-desc">{{item.description}}</text>
        </view>
        <text class="tip-arrow">></text>
      </view>
    </view>
  </view>
</view>

<!-- é£Ÿå“è¯¦æƒ…å¼¹çª— -->
<view class="food-modal" wx:if="{{showFoodDetail}}" bindtap="onCloseFoodDetail">
  <view class="food-detail" catchtap="stopPropagation">
    <view class="detail-header">
      <image class="detail-image" src="{{currentFood.image}}" mode="aspectFill"></image>
      <text class="detail-close" bindtap="onCloseFoodDetail">âœ•</text>
    </view>
    
    <scroll-view class="detail-content" scroll-y>
      <view class="detail-basic">
        <text class="detail-name">{{currentFood.name}}</text>
        <text class="detail-latin">{{currentFood.latinName}}</text>
        <view class="detail-tags">
          <text class="detail-tag" wx:for="{{currentFood.tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
        </view>
      </view>
      
      <view class="detail-section">
        <text class="detail-section-title">è¥å…»æˆåˆ†</text>
        <view class="nutrition-grid">
          <view class="nutrition-item" wx:for="{{currentFood.nutrition}}" wx:key="name">
            <text class="nutrition-name">{{item.name}}</text>
            <text class="nutrition-value">{{item.value}}</text>
            <text class="nutrition-unit">{{item.unit}}</text>
          </view>
        </view>
      </view>
      
      <view class="detail-section">
        <text class="detail-section-title">åŠŸæ•ˆä½œç”¨</text>
        <text class="detail-text">{{currentFood.benefits}}</text>
      </view>
      
      <view class="detail-section">
        <text class="detail-section-title">é£Ÿç”¨å»ºè®®</text>
        <text class="detail-text">{{currentFood.suggestions}}</text>
      </view>
      
      <view class="detail-section" wx:if="{{currentFood.precautions}}">
        <text class="detail-section-title">æ³¨æ„äº‹é¡¹</text>
        <text class="detail-text warning">{{currentFood.precautions}}</text>
      </view>
      
      <view class="detail-section">
        <text class="detail-section-title">ä¿å­˜æ–¹æ³•</text>
        <text class="detail-text">{{currentFood.storage}}</text>
      </view>
    </scroll-view>
    
    <view class="detail-actions">
      <button class="action-btn secondary" bindtap="onCollectFood">
        <text class="btn-icon">{{currentFood.collected ? 'â¤ï¸' : 'ğŸ¤'}}</text>
        <text class="btn-text">{{currentFood.collected ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
      </button>
      
      <button class="action-btn primary" bindtap="onDetectFood">
        <text class="btn-icon">ğŸ“¸</text>
        <text class="btn-text">æ£€æµ‹æ­¤é£Ÿå“</text>
      </button>
    </view>
  </view>
</view>