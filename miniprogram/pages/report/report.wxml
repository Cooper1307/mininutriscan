<!--pages/report/report.wxml-->
<view class="page">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <navigation-bar title="é—®é¢˜ä¸¾æŠ¥" show-back="{{true}}"></navigation-bar>

  <!-- ä¸¾æŠ¥ç±»å‹é€‰æ‹© -->
  <view class="report-types">
    <view class="section-header">
      <view class="section-title">ä¸¾æŠ¥ç±»å‹</view>
      <view class="section-subtitle">è¯·é€‰æ‹©æ‚¨è¦ä¸¾æŠ¥çš„é—®é¢˜ç±»å‹</view>
    </view>
    
    <view class="types-grid">
      <view wx:for="{{reportTypes}}" wx:key="id" 
            class="type-item {{selectedType === item.id ? 'selected' : ''}}"
            bindtap="selectType" data-type="{{item}}">
        <view class="type-icon">{{item.icon}}</view>
        <view class="type-name">{{item.name}}</view>
        <view class="type-desc">{{item.description}}</view>
      </view>
    </view>
  </view>

  <!-- è¯¦ç»†ä¿¡æ¯ -->
  <view class="report-details">
    <view class="section-header">
      <view class="section-title">è¯¦ç»†ä¿¡æ¯</view>
      <view class="section-subtitle">è¯·è¯¦ç»†æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜</view>
    </view>
    
    <view class="form-container">
      <!-- é—®é¢˜æ ‡é¢˜ -->
      <view class="form-group">
        <view class="form-label">é—®é¢˜æ ‡é¢˜ <text class="required">*</text></view>
        <input class="form-input" 
               placeholder="è¯·ç®€è¦æè¿°é—®é¢˜" 
               value="{{reportData.title}}"
               bindinput="onTitleInput" 
               maxlength="50" />
        <view class="input-counter">{{reportData.title.length}}/50</view>
      </view>
      
      <!-- é—®é¢˜æè¿° -->
      <view class="form-group">
        <view class="form-label">é—®é¢˜æè¿° <text class="required">*</text></view>
        <textarea class="form-textarea" 
                  placeholder="è¯·è¯¦ç»†æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜ï¼ŒåŒ…æ‹¬å…·ä½“æƒ…å†µã€å‘ç”Ÿæ—¶é—´ç­‰" 
                  value="{{reportData.description}}"
                  bindinput="onDescriptionInput" 
                  maxlength="500"
                  auto-height></textarea>
        <view class="input-counter">{{reportData.description.length}}/500</view>
      </view>
      
      <!-- è”ç³»æ–¹å¼ -->
      <view class="form-group">
        <view class="form-label">è”ç³»æ–¹å¼</view>
        <input class="form-input" 
               placeholder="æ‰‹æœºå·æˆ–å¾®ä¿¡å·ï¼ˆé€‰å¡«ï¼Œä¾¿äºæˆ‘ä»¬è”ç³»æ‚¨ï¼‰" 
               value="{{reportData.contact}}"
               bindinput="onContactInput" 
               maxlength="20" />
      </view>
      
      <!-- å‘ç”Ÿåœ°ç‚¹ -->
      <view class="form-group">
        <view class="form-label">å‘ç”Ÿåœ°ç‚¹</view>
        <view class="location-input" bindtap="chooseLocation">
          <input class="form-input" 
                 placeholder="ç‚¹å‡»é€‰æ‹©åœ°ç‚¹" 
                 value="{{reportData.location}}"
                 disabled />
          <view class="location-icon">ğŸ“</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸Šä¼ è¯æ® -->
  <view class="evidence-section">
    <view class="section-header">
      <view class="section-title">ä¸Šä¼ è¯æ®</view>
      <view class="section-subtitle">ç…§ç‰‡æˆ–è§†é¢‘æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½åœ°å¤„ç†é—®é¢˜</view>
    </view>
    
    <view class="upload-container">
      <view class="uploaded-files">
        <view wx:for="{{reportData.evidence}}" wx:key="index" class="file-item">
          <image wx:if="{{item.type === 'image'}}" src="{{item.url}}" class="file-preview" bindtap="previewImage" data-url="{{item.url}}"></image>
          <video wx:elif="{{item.type === 'video'}}" src="{{item.url}}" class="file-preview" controls></video>
          <view class="file-remove" bindtap="removeFile" data-index="{{index}}">Ã—</view>
        </view>
        
        <view wx:if="{{reportData.evidence.length < 6}}" class="upload-btn" bindtap="chooseMedia">
          <view class="upload-icon">ğŸ“·</view>
          <view class="upload-text">æ·»åŠ å›¾ç‰‡/è§†é¢‘</view>
          <view class="upload-hint">æœ€å¤š6å¼ </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç´§æ€¥ç¨‹åº¦ -->
  <view class="urgency-section">
    <view class="section-header">
      <view class="section-title">ç´§æ€¥ç¨‹åº¦</view>
    </view>
    
    <view class="urgency-options">
      <view wx:for="{{urgencyLevels}}" wx:key="id" 
            class="urgency-item {{selectedUrgency === item.id ? 'selected' : ''}}"
            bindtap="selectUrgency" data-urgency="{{item}}">
        <view class="urgency-icon {{item.level}}">{{item.icon}}</view>
        <view class="urgency-content">
          <view class="urgency-name">{{item.name}}</view>
          <view class="urgency-desc">{{item.description}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æäº¤æŒ‰é’® -->
  <view class="submit-section">
    <view class="submit-tips">
      <view class="tip-item">
        <view class="tip-icon">ğŸ”’</view>
        <view class="tip-text">æ‚¨çš„ä¿¡æ¯å°†è¢«ä¸¥æ ¼ä¿å¯†</view>
      </view>
      <view class="tip-item">
        <view class="tip-icon">âš¡</view>
        <view class="tip-text">æˆ‘ä»¬ä¼šåœ¨24å°æ—¶å†…å¤„ç†</view>
      </view>
    </view>
    
    <button class="submit-btn" 
            bindtap="submitReport" 
            disabled="{{!canSubmit || submitting}}">
      <text class="btn-icon">{{submitting ? 'â³' : 'ğŸ“¤'}}</text>
      {{submitting ? 'æäº¤ä¸­...' : 'æäº¤ä¸¾æŠ¥'}}
    </button>
  </view>

  <!-- å†å²ä¸¾æŠ¥ -->
  <view class="history-section">
    <view class="section-header">
      <view class="section-title">æˆ‘çš„ä¸¾æŠ¥</view>
      <view class="view-all" bindtap="viewAllReports">æŸ¥çœ‹å…¨éƒ¨</view>
    </view>
    
    <view wx:if="{{reportHistory.length > 0}}" class="history-list">
      <view wx:for="{{reportHistory}}" wx:key="id" class="history-item" bindtap="viewReportDetail" data-report="{{item}}">
        <view class="history-content">
          <view class="history-title">{{item.title}}</view>
          <view class="history-status {{item.status}}">
            <text class="status-icon">{{getStatusIcon(item.status)}}</text>
            <text class="status-text">{{getStatusText(item.status)}}</text>
          </view>
          <view class="history-time">{{item.createTime}}</view>
        </view>
        <view class="history-arrow">â€º</view>
      </view>
    </view>
    
    <view wx:else class="empty-history">
      <view class="empty-icon">ğŸ“</view>
      <view class="empty-text">æš‚æ— ä¸¾æŠ¥è®°å½•</view>
    </view>
  </view>
</view>

<!-- åŠ è½½é®ç½© -->
<view wx:if="{{showLoading}}" class="loading-overlay">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <view class="loading-text">{{loadingText}}</view>
  </view>
</view>