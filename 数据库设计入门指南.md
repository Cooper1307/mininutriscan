# ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡å…¥é—¨æŒ‡å— - ç¤¾åŒºé£Ÿå®‰AIå°å«å£«

> ä¸“ä¸ºæ–°æ‰‹è®¾è®¡çš„æ•°æ®åº“æ•™ç¨‹ï¼Œä»æ¦‚å¿µåˆ°å®è·µ

## ğŸ“š ä»€ä¹ˆæ˜¯æ•°æ®åº“ï¼Ÿ

**ç®€å•ç†è§£ï¼š**
æ•°æ®åº“å°±åƒä¸€ä¸ªè¶…çº§æ•´ç†æŸœï¼Œç”¨æ¥å­˜å‚¨å’Œç®¡ç†æˆ‘ä»¬å°ç¨‹åºçš„æ‰€æœ‰æ•°æ®ï¼š
- ç”¨æˆ·ä¿¡æ¯ï¼ˆè°åœ¨ä½¿ç”¨æˆ‘ä»¬çš„å°ç¨‹åºï¼‰
- ä¸¾æŠ¥è®°å½•ï¼ˆç”¨æˆ·ä¸Šä¼ çš„é£Ÿå“å®‰å…¨é—®é¢˜ï¼‰
- è¥å…»åˆ†æç»“æœï¼ˆAIåˆ†æçš„é£Ÿå“è¥å…»ä¿¡æ¯ï¼‰
- å¿—æ„¿è€…ä¿¡æ¯ï¼ˆç¤¾åŒºå¿—æ„¿è€…æ•°æ®ï¼‰

**ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“ï¼Ÿ**
- ğŸ“± å°ç¨‹åºå…³é—­åï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±
- ğŸ” å¯ä»¥å¿«é€ŸæŸ¥æ‰¾å’Œç­›é€‰ä¿¡æ¯
- ğŸ‘¥ å¤šä¸ªç”¨æˆ·å¯ä»¥åŒæ—¶ä½¿ç”¨
- ğŸ”’ æ•°æ®å®‰å…¨æœ‰ä¿éšœ

---

## ğŸ—ï¸ æˆ‘ä»¬çš„æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒæ•°æ®è¡¨è®¾è®¡

æˆ‘ä»¬çš„å°ç¨‹åºéœ€è¦ä»¥ä¸‹å‡ å¼ "è¡¨"ï¼ˆå¯ä»¥ç†è§£ä¸ºExcelçš„å·¥ä½œè¡¨ï¼‰ï¼š

#### 1. ç”¨æˆ·è¡¨ (users)
å­˜å‚¨æ‰€æœ‰ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| id | æ•´æ•° | ç”¨æˆ·å”¯ä¸€ç¼–å· | 1, 2, 3... |
| openid | æ–‡æœ¬ | å¾®ä¿¡ç”¨æˆ·æ ‡è¯† | "ox1234567890" |
| nickname | æ–‡æœ¬ | ç”¨æˆ·æ˜µç§° | "å¼ ä¸‰" |
| avatar_url | æ–‡æœ¬ | å¤´åƒé“¾æ¥ | "https://..." |
| phone | æ–‡æœ¬ | æ‰‹æœºå· | "13812345678" |
| role | æ–‡æœ¬ | ç”¨æˆ·è§’è‰² | "user", "volunteer", "admin" |
| community_id | æ•´æ•° | æ‰€å±ç¤¾åŒºID | 1, 2, 3... |
| created_at | æ—¶é—´ | æ³¨å†Œæ—¶é—´ | "2024-01-15 10:30:00" |
| is_active | å¸ƒå°” | æ˜¯å¦æ¿€æ´» | true, false |

#### 2. ç¤¾åŒºè¡¨ (communities)
å­˜å‚¨ç¤¾åŒºä¿¡æ¯

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| id | æ•´æ•° | ç¤¾åŒºå”¯ä¸€ç¼–å· | 1, 2, 3... |
| name | æ–‡æœ¬ | ç¤¾åŒºåç§° | "é˜³å…‰èŠ±å›­ç¤¾åŒº" |
| address | æ–‡æœ¬ | ç¤¾åŒºåœ°å€ | "ä¸Šæµ·å¸‚æ™®é™€åŒº..." |
| contact_person | æ–‡æœ¬ | è”ç³»äºº | "æä¸»ä»»" |
| contact_phone | æ–‡æœ¬ | è”ç³»ç”µè¯ | "021-12345678" |
| created_at | æ—¶é—´ | åˆ›å»ºæ—¶é—´ | "2024-01-01 00:00:00" |

#### 3. ä¸¾æŠ¥è¡¨ (reports)
å­˜å‚¨ç”¨æˆ·ä¸¾æŠ¥çš„é£Ÿå“å®‰å…¨é—®é¢˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| id | æ•´æ•° | ä¸¾æŠ¥å”¯ä¸€ç¼–å· | 1, 2, 3... |
| user_id | æ•´æ•° | ä¸¾æŠ¥ç”¨æˆ·ID | 1 |
| title | æ–‡æœ¬ | ä¸¾æŠ¥æ ‡é¢˜ | "è¶…å¸‚è¿‡æœŸé£Ÿå“" |
| description | æ–‡æœ¬ | è¯¦ç»†æè¿° | "å‘ç°æŸè¶…å¸‚é”€å”®è¿‡æœŸç‰›å¥¶" |
| category | æ–‡æœ¬ | ä¸¾æŠ¥ç±»åˆ« | "è¿‡æœŸé£Ÿå“", "æ— è¯ç»è¥" |
| location | æ–‡æœ¬ | ä¸¾æŠ¥åœ°ç‚¹ | "XXè·¯XXå·" |
| images | æ–‡æœ¬ | å›¾ç‰‡é“¾æ¥ | "[\"url1\", \"url2\"]" |
| status | æ–‡æœ¬ | å¤„ç†çŠ¶æ€ | "pending", "processing", "resolved" |
| priority | æ–‡æœ¬ | ä¼˜å…ˆçº§ | "low", "medium", "high" |
| assigned_to | æ•´æ•° | åˆ†é…ç»™å¿—æ„¿è€…ID | 2 |
| created_at | æ—¶é—´ | ä¸¾æŠ¥æ—¶é—´ | "2024-01-15 14:30:00" |
| updated_at | æ—¶é—´ | æ›´æ–°æ—¶é—´ | "2024-01-15 15:00:00" |

#### 4. è¥å…»åˆ†æè¡¨ (nutrition_analyses)
å­˜å‚¨AIåˆ†æçš„é£Ÿå“è¥å…»ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| id | æ•´æ•° | åˆ†æè®°å½•ID | 1, 2, 3... |
| user_id | æ•´æ•° | ç”¨æˆ·ID | 1 |
| food_name | æ–‡æœ¬ | é£Ÿå“åç§° | "è‹¹æœ" |
| image_url | æ–‡æœ¬ | é£Ÿå“å›¾ç‰‡ | "https://..." |
| ocr_text | æ–‡æœ¬ | OCRè¯†åˆ«æ–‡å­— | "è¥å…»æˆåˆ†è¡¨ï¼šè›‹ç™½è´¨..." |
| ai_analysis | æ–‡æœ¬ | AIåˆ†æç»“æœ | "{\"calories\": 52, ...}" |
| nutrition_score | æ•´æ•° | è¥å…»è¯„åˆ† | 85 |
| health_advice | æ–‡æœ¬ | å¥åº·å»ºè®® | "é€‚é‡é£Ÿç”¨ï¼Œå¯Œå«ç»´ç”Ÿç´ C" |
| created_at | æ—¶é—´ | åˆ†ææ—¶é—´ | "2024-01-15 16:00:00" |

#### 5. å¿—æ„¿è€…æ´»åŠ¨è¡¨ (volunteer_activities)
å­˜å‚¨å¿—æ„¿è€…å‚ä¸çš„æ´»åŠ¨

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| id | æ•´æ•° | æ´»åŠ¨ID | 1, 2, 3... |
| volunteer_id | æ•´æ•° | å¿—æ„¿è€…ID | 2 |
| activity_type | æ–‡æœ¬ | æ´»åŠ¨ç±»å‹ | "ä¸¾æŠ¥å¤„ç†", "ç§‘æ™®å®£ä¼ " |
| description | æ–‡æœ¬ | æ´»åŠ¨æè¿° | "å¤„ç†é£Ÿå“å®‰å…¨ä¸¾æŠ¥" |
| hours | å°æ•° | æœåŠ¡æ—¶é•¿ | 2.5 |
| status | æ–‡æœ¬ | çŠ¶æ€ | "completed", "in_progress" |
| created_at | æ—¶é—´ | åˆ›å»ºæ—¶é—´ | "2024-01-15 09:00:00" |

---

## ğŸ’» å®é™…åˆ›å»ºæ•°æ®åº“

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…æ•°æ®åº“ç›¸å…³åŒ…

æ‰“å¼€å‘½ä»¤è¡Œï¼ˆç¡®ä¿åœ¨backendç›®å½•ä¸‹ï¼Œè™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ï¼‰ï¼š

```bash
# å®‰è£…SQLAlchemyï¼ˆæ•°æ®åº“ORMå·¥å…·ï¼‰
pip install sqlalchemy

# å®‰è£…Alembicï¼ˆæ•°æ®åº“è¿ç§»å·¥å…·ï¼‰
pip install alembic

# å®‰è£…python-dotenvï¼ˆç¯å¢ƒå˜é‡ç®¡ç†ï¼‰
pip install python-dotenv
```

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ•°æ®åº“æ¨¡å‹æ–‡ä»¶

åœ¨`backend`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºæ–‡ä»¶ï¼š`models.py`

```python
# models.py - æ•°æ®åº“æ¨¡å‹å®šä¹‰
from sqlalchemy import Column, Integer, String, Text, DateTime, Boolean, Float, ForeignKey
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import relationship
from datetime import datetime

# åˆ›å»ºåŸºç¡€æ¨¡å‹ç±»
Base = declarative_base()

class Community(Base):
    """ç¤¾åŒºè¡¨"""
    __tablename__ = "communities"
    
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String(100), nullable=False, comment="ç¤¾åŒºåç§°")
    address = Column(Text, comment="ç¤¾åŒºåœ°å€")
    contact_person = Column(String(50), comment="è”ç³»äºº")
    contact_phone = Column(String(20), comment="è”ç³»ç”µè¯")
    created_at = Column(DateTime, default=datetime.utcnow, comment="åˆ›å»ºæ—¶é—´")
    
    # å…³è”å…³ç³»ï¼šä¸€ä¸ªç¤¾åŒºæœ‰å¤šä¸ªç”¨æˆ·
    users = relationship("User", back_populates="community")

class User(Base):
    """ç”¨æˆ·è¡¨"""
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True, index=True)
    openid = Column(String(100), unique=True, nullable=False, comment="å¾®ä¿¡openid")
    nickname = Column(String(50), comment="ç”¨æˆ·æ˜µç§°")
    avatar_url = Column(Text, comment="å¤´åƒURL")
    phone = Column(String(20), comment="æ‰‹æœºå·")
    role = Column(String(20), default="user", comment="ç”¨æˆ·è§’è‰²ï¼šuser/volunteer/admin")
    community_id = Column(Integer, ForeignKey("communities.id"), comment="æ‰€å±ç¤¾åŒºID")
    created_at = Column(DateTime, default=datetime.utcnow, comment="æ³¨å†Œæ—¶é—´")
    is_active = Column(Boolean, default=True, comment="æ˜¯å¦æ¿€æ´»")
    
    # å…³è”å…³ç³»
    community = relationship("Community", back_populates="users")
    reports = relationship("Report", back_populates="user")
    nutrition_analyses = relationship("NutritionAnalysis", back_populates="user")
    volunteer_activities = relationship("VolunteerActivity", back_populates="volunteer")

class Report(Base):
    """ä¸¾æŠ¥è¡¨"""
    __tablename__ = "reports"
    
    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False, comment="ä¸¾æŠ¥ç”¨æˆ·ID")
    title = Column(String(200), nullable=False, comment="ä¸¾æŠ¥æ ‡é¢˜")
    description = Column(Text, comment="è¯¦ç»†æè¿°")
    category = Column(String(50), comment="ä¸¾æŠ¥ç±»åˆ«")
    location = Column(Text, comment="ä¸¾æŠ¥åœ°ç‚¹")
    images = Column(Text, comment="å›¾ç‰‡é“¾æ¥JSONæ•°ç»„")
    status = Column(String(20), default="pending", comment="å¤„ç†çŠ¶æ€")
    priority = Column(String(10), default="medium", comment="ä¼˜å…ˆçº§")
    assigned_to = Column(Integer, ForeignKey("users.id"), comment="åˆ†é…ç»™å¿—æ„¿è€…ID")
    created_at = Column(DateTime, default=datetime.utcnow, comment="ä¸¾æŠ¥æ—¶é—´")
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow, comment="æ›´æ–°æ—¶é—´")
    
    # å…³è”å…³ç³»
    user = relationship("User", back_populates="reports", foreign_keys=[user_id])
    assigned_volunteer = relationship("User", foreign_keys=[assigned_to])

class NutritionAnalysis(Base):
    """è¥å…»åˆ†æè¡¨"""
    __tablename__ = "nutrition_analyses"
    
    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False, comment="ç”¨æˆ·ID")
    food_name = Column(String(100), comment="é£Ÿå“åç§°")
    image_url = Column(Text, comment="é£Ÿå“å›¾ç‰‡URL")
    ocr_text = Column(Text, comment="OCRè¯†åˆ«çš„æ–‡å­—")
    ai_analysis = Column(Text, comment="AIåˆ†æç»“æœJSON")
    nutrition_score = Column(Integer, comment="è¥å…»è¯„åˆ†0-100")
    health_advice = Column(Text, comment="å¥åº·å»ºè®®")
    created_at = Column(DateTime, default=datetime.utcnow, comment="åˆ†ææ—¶é—´")
    
    # å…³è”å…³ç³»
    user = relationship("User", back_populates="nutrition_analyses")

class VolunteerActivity(Base):
    """å¿—æ„¿è€…æ´»åŠ¨è¡¨"""
    __tablename__ = "volunteer_activities"
    
    id = Column(Integer, primary_key=True, index=True)
    volunteer_id = Column(Integer, ForeignKey("users.id"), nullable=False, comment="å¿—æ„¿è€…ID")
    activity_type = Column(String(50), comment="æ´»åŠ¨ç±»å‹")
    description = Column(Text, comment="æ´»åŠ¨æè¿°")
    hours = Column(Float, comment="æœåŠ¡æ—¶é•¿ï¼ˆå°æ—¶ï¼‰")
    status = Column(String(20), default="in_progress", comment="çŠ¶æ€")
    created_at = Column(DateTime, default=datetime.utcnow, comment="åˆ›å»ºæ—¶é—´")
    
    # å…³è”å…³ç³»
    volunteer = relationship("User", back_populates="volunteer_activities")

# å¦‚æœç›´æ¥è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œæ‰“å°æ‰€æœ‰è¡¨ç»“æ„
if __name__ == "__main__":
    print("ğŸ“‹ æ•°æ®åº“è¡¨ç»“æ„ï¼š")
    print("1. communities - ç¤¾åŒºè¡¨")
    print("2. users - ç”¨æˆ·è¡¨")
    print("3. reports - ä¸¾æŠ¥è¡¨")
    print("4. nutrition_analyses - è¥å…»åˆ†æè¡¨")
    print("5. volunteer_activities - å¿—æ„¿è€…æ´»åŠ¨è¡¨")
    print("\nâœ… æ•°æ®åº“æ¨¡å‹å®šä¹‰å®Œæˆï¼")
```

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºæ•°æ®åº“è¿æ¥æ–‡ä»¶

åœ¨`backend`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºæ–‡ä»¶ï¼š`database.py`

```python
# database.py - æ•°æ®åº“è¿æ¥å’Œä¼šè¯ç®¡ç†
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from models import Base
import os
from dotenv import load_dotenv

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()

# è·å–æ•°æ®åº“URLï¼ˆä».envæ–‡ä»¶ï¼‰
DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///./community_food_safety.db")

print(f"ğŸ“Š ä½¿ç”¨æ•°æ®åº“ï¼š{DATABASE_URL}")

# åˆ›å»ºæ•°æ®åº“å¼•æ“
engine = create_engine(
    DATABASE_URL,
    # SQLiteç‰¹æ®Šé…ç½®
    connect_args={"check_same_thread": False} if "sqlite" in DATABASE_URL else {}
)

# åˆ›å»ºä¼šè¯å·¥å‚
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

def create_tables():
    """åˆ›å»ºæ‰€æœ‰æ•°æ®åº“è¡¨"""
    print("ğŸ—ï¸  æ­£åœ¨åˆ›å»ºæ•°æ®åº“è¡¨...")
    Base.metadata.create_all(bind=engine)
    print("âœ… æ•°æ®åº“è¡¨åˆ›å»ºå®Œæˆï¼")

def get_db():
    """è·å–æ•°æ®åº“ä¼šè¯"""
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

def init_sample_data():
    """åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®"""
    from models import Community, User
    
    db = SessionLocal()
    try:
        # æ£€æŸ¥æ˜¯å¦å·²æœ‰æ•°æ®
        if db.query(Community).first():
            print("ğŸ“‹ æ•°æ®åº“å·²æœ‰æ•°æ®ï¼Œè·³è¿‡åˆå§‹åŒ–")
            return
        
        print("ğŸŒ± æ­£åœ¨åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®...")
        
        # åˆ›å»ºç¤ºä¾‹ç¤¾åŒº
        community1 = Community(
            name="é˜³å…‰èŠ±å›­ç¤¾åŒº",
            address="ä¸Šæµ·å¸‚æ™®é™€åŒºé˜³å…‰è·¯123å·",
            contact_person="æä¸»ä»»",
            contact_phone="021-12345678"
        )
        
        community2 = Community(
            name="ç»¿è‰²å®¶å›­ç¤¾åŒº",
            address="ä¸Šæµ·å¸‚æ™®é™€åŒºç»¿è‰²å¤§é“456å·",
            contact_person="ç‹ä¸»ä»»",
            contact_phone="021-87654321"
        )
        
        db.add(community1)
        db.add(community2)
        db.commit()
        
        # åˆ›å»ºç¤ºä¾‹ç”¨æˆ·
        admin_user = User(
            openid="admin_test_openid",
            nickname="ç³»ç»Ÿç®¡ç†å‘˜",
            role="admin",
            community_id=community1.id,
            phone="13800138000"
        )
        
        volunteer_user = User(
            openid="volunteer_test_openid",
            nickname="å¿—æ„¿è€…å°å¼ ",
            role="volunteer",
            community_id=community1.id,
            phone="13800138001"
        )
        
        normal_user = User(
            openid="user_test_openid",
            nickname="æ™®é€šç”¨æˆ·å°æ",
            role="user",
            community_id=community2.id,
            phone="13800138002"
        )
        
        db.add(admin_user)
        db.add(volunteer_user)
        db.add(normal_user)
        db.commit()
        
        print("âœ… ç¤ºä¾‹æ•°æ®åˆå§‹åŒ–å®Œæˆï¼")
        print(f"   - åˆ›å»ºäº† {db.query(Community).count()} ä¸ªç¤¾åŒº")
        print(f"   - åˆ›å»ºäº† {db.query(User).count()} ä¸ªç”¨æˆ·")
        
    except Exception as e:
        print(f"âŒ åˆå§‹åŒ–æ•°æ®å¤±è´¥ï¼š{str(e)}")
        db.rollback()
    finally:
        db.close()

if __name__ == "__main__":
    print("ğŸš€ åˆå§‹åŒ–æ•°æ®åº“...")
    create_tables()
    init_sample_data()
    print("ğŸ‰ æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼")
```

### ç¬¬å››æ­¥ï¼šåˆ›å»ºæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

åœ¨`backend`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºæ–‡ä»¶ï¼š`init_database.py`

```python
# init_database.py - æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
from database import create_tables, init_sample_data
from models import *
import os

def main():
    print("ğŸ¯ ç¤¾åŒºé£Ÿå®‰AIå°å«å£« - æ•°æ®åº“åˆå§‹åŒ–")
    print("=" * 50)
    
    try:
        # 1. åˆ›å»ºæ•°æ®åº“è¡¨
        print("\nğŸ“‹ æ­¥éª¤1ï¼šåˆ›å»ºæ•°æ®åº“è¡¨")
        create_tables()
        
        # 2. åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
        print("\nğŸŒ± æ­¥éª¤2ï¼šåˆå§‹åŒ–ç¤ºä¾‹æ•°æ®")
        init_sample_data()
        
        # 3. éªŒè¯æ•°æ®åº“
        print("\nğŸ” æ­¥éª¤3ï¼šéªŒè¯æ•°æ®åº“")
        verify_database()
        
        print("\nğŸ‰ æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸï¼")
        print("\nğŸ“ æ¥ä¸‹æ¥ä½ å¯ä»¥ï¼š")
        print("   1. è¿è¡Œ python main.py å¯åŠ¨APIæœåŠ¡å™¨")
        print("   2. è®¿é—® http://localhost:8000/docs æŸ¥çœ‹APIæ–‡æ¡£")
        print("   3. å¼€å§‹å¼€å‘å°ç¨‹åºå‰ç«¯")
        
    except Exception as e:
        print(f"\nâŒ åˆå§‹åŒ–å¤±è´¥ï¼š{str(e)}")
        print("\nğŸ”§ è¯·æ£€æŸ¥ï¼š")
        print("   1. .envæ–‡ä»¶æ˜¯å¦æ­£ç¡®é…ç½®")
        print("   2. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸")
        print("   3. å¿…è¦çš„PythonåŒ…æ˜¯å¦å·²å®‰è£…")

def verify_database():
    """éªŒè¯æ•°æ®åº“æ˜¯å¦æ­£å¸¸"""
    from database import SessionLocal
    from models import Community, User
    
    db = SessionLocal()
    try:
        # æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨ä¸”æœ‰æ•°æ®
        community_count = db.query(Community).count()
        user_count = db.query(User).count()
        
        print(f"   âœ… ç¤¾åŒºè¡¨ï¼š{community_count} æ¡è®°å½•")
        print(f"   âœ… ç”¨æˆ·è¡¨ï¼š{user_count} æ¡è®°å½•")
        
        # æ˜¾ç¤ºç¤ºä¾‹æ•°æ®
        if community_count > 0:
            first_community = db.query(Community).first()
            print(f"   ğŸ“ ç¤ºä¾‹ç¤¾åŒºï¼š{first_community.name}")
        
        if user_count > 0:
            admin_user = db.query(User).filter(User.role == "admin").first()
            if admin_user:
                print(f"   ğŸ‘¤ ç®¡ç†å‘˜ï¼š{admin_user.nickname}")
        
    except Exception as e:
        print(f"   âŒ éªŒè¯å¤±è´¥ï¼š{str(e)}")
        raise
    finally:
        db.close()

if __name__ == "__main__":
    main()
```

### ç¬¬äº”æ­¥ï¼šè¿è¡Œæ•°æ®åº“åˆå§‹åŒ–

åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œï¼š

```bash
# ç¡®ä¿åœ¨backendç›®å½•ä¸‹ï¼Œè™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
python init_database.py
```

å¦‚æœçœ‹åˆ°"ğŸ‰ æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸï¼"ï¼Œè¯´æ˜æ•°æ®åº“åˆ›å»ºæˆåŠŸï¼

### ç¬¬å…­æ­¥ï¼šéªŒè¯æ•°æ®åº“

åˆ›å»ºä¸€ä¸ªç®€å•çš„æŸ¥è¯¢è„šæœ¬æ¥éªŒè¯æ•°æ®åº“ï¼š`test_database.py`

```python
# test_database.py - æµ‹è¯•æ•°æ®åº“è¿æ¥å’ŒæŸ¥è¯¢
from database import SessionLocal
from models import Community, User, Report

def test_database():
    print("ğŸ§ª æµ‹è¯•æ•°æ®åº“è¿æ¥å’ŒæŸ¥è¯¢...")
    
    db = SessionLocal()
    try:
        # æŸ¥è¯¢æ‰€æœ‰ç¤¾åŒº
        communities = db.query(Community).all()
        print(f"\nğŸ“ ç¤¾åŒºåˆ—è¡¨ ({len(communities)}ä¸ª):")
        for community in communities:
            print(f"   - {community.name} ({community.address})")
        
        # æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
        users = db.query(User).all()
        print(f"\nğŸ‘¥ ç”¨æˆ·åˆ—è¡¨ ({len(users)}ä¸ª):")
        for user in users:
            print(f"   - {user.nickname} ({user.role}) - {user.community.name if user.community else 'æ— ç¤¾åŒº'}")
        
        # ç»Ÿè®¡ä¿¡æ¯
        print(f"\nğŸ“Š æ•°æ®ç»Ÿè®¡:")
        print(f"   - æ€»ç¤¾åŒºæ•°ï¼š{db.query(Community).count()}")
        print(f"   - æ€»ç”¨æˆ·æ•°ï¼š{db.query(User).count()}")
        print(f"   - ç®¡ç†å‘˜æ•°ï¼š{db.query(User).filter(User.role == 'admin').count()}")
        print(f"   - å¿—æ„¿è€…æ•°ï¼š{db.query(User).filter(User.role == 'volunteer').count()}")
        print(f"   - æ™®é€šç”¨æˆ·æ•°ï¼š{db.query(User).filter(User.role == 'user').count()}")
        print(f"   - ä¸¾æŠ¥è®°å½•æ•°ï¼š{db.query(Report).count()}")
        
        print("\nâœ… æ•°æ®åº“æµ‹è¯•é€šè¿‡ï¼")
        
    except Exception as e:
        print(f"âŒ æ•°æ®åº“æµ‹è¯•å¤±è´¥ï¼š{str(e)}")
    finally:
        db.close()

if __name__ == "__main__":
    test_database()
```

è¿è¡Œæµ‹è¯•ï¼š
```bash
python test_database.py
```

---

## ğŸ¯ æ•°æ®åº“è®¾è®¡è¦ç‚¹æ€»ç»“

### âœ… æˆ‘ä»¬å®Œæˆäº†ä»€ä¹ˆï¼š

1. **è®¾è®¡äº†å®Œæ•´çš„æ•°æ®åº“ç»“æ„**
   - 5å¼ æ ¸å¿ƒæ•°æ®è¡¨
   - æ¸…æ™°çš„å…³è”å…³ç³»
   - åˆç†çš„å­—æ®µç±»å‹

2. **åˆ›å»ºäº†æ•°æ®åº“æ¨¡å‹**
   - ä½¿ç”¨SQLAlchemy ORM
   - å®šä¹‰äº†æ‰€æœ‰è¡¨ç»“æ„
   - å»ºç«‹äº†è¡¨ä¹‹é—´çš„å…³ç³»

3. **å®ç°äº†æ•°æ®åº“ç®¡ç†**
   - è‡ªåŠ¨åˆ›å»ºè¡¨ç»“æ„
   - åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
   - æ•°æ®åº“è¿æ¥ç®¡ç†

4. **æä¾›äº†æµ‹è¯•å·¥å…·**
   - æ•°æ®åº“è¿æ¥æµ‹è¯•
   - æ•°æ®æŸ¥è¯¢éªŒè¯
   - é”™è¯¯è¯Šæ–­åŠŸèƒ½

### ğŸ”‘ å…³é”®æ¦‚å¿µç†è§£ï¼š

- **ä¸»é”® (Primary Key)**ï¼šæ¯æ¡è®°å½•çš„å”¯ä¸€æ ‡è¯†
- **å¤–é”® (Foreign Key)**ï¼šè¿æ¥ä¸åŒè¡¨çš„æ¡¥æ¢
- **å…³è”å…³ç³» (Relationship)**ï¼šè¡¨ä¸è¡¨ä¹‹é—´çš„é€»è¾‘è¿æ¥
- **ç´¢å¼• (Index)**ï¼šæé«˜æŸ¥è¯¢é€Ÿåº¦çš„å·¥å…·

### ğŸ“ˆ ä¸‹ä¸€æ­¥è®¡åˆ’ï¼š

1. **åˆ›å»ºAPIæ¥å£**ï¼šè®©å‰ç«¯å¯ä»¥æ“ä½œæ•°æ®åº“
2. **å®ç°ç”¨æˆ·è®¤è¯**ï¼šå¾®ä¿¡ç™»å½•å’Œæƒé™ç®¡ç†
3. **å¼€å‘æ ¸å¿ƒåŠŸèƒ½**ï¼šä¸¾æŠ¥ã€åˆ†æã€ç®¡ç†ç­‰
4. **é›†æˆAIæœåŠ¡**ï¼šOCRå’Œæ™ºèƒ½é—®ç­”

---

## ğŸ†˜ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1ï¼šæ•°æ®åº“æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ
**ç­”æ¡ˆ**ï¼šSQLiteæ•°æ®åº“æ–‡ä»¶ `community_food_safety.db` åœ¨backendç›®å½•ä¸‹

### é—®é¢˜2ï¼šå¦‚ä½•æŸ¥çœ‹æ•°æ®åº“å†…å®¹ï¼Ÿ
**ç­”æ¡ˆ**ï¼š
1. ä¸‹è½½ DB Browser for SQLite
2. æ‰“å¼€ `community_food_safety.db` æ–‡ä»¶
3. å¯ä»¥å›¾å½¢åŒ–æŸ¥çœ‹å’Œç¼–è¾‘æ•°æ®

### é—®é¢˜3ï¼šå¦‚ä½•é‡ç½®æ•°æ®åº“ï¼Ÿ
**ç­”æ¡ˆ**ï¼š
```bash
# åˆ é™¤æ•°æ®åº“æ–‡ä»¶
del community_food_safety.db
# é‡æ–°åˆå§‹åŒ–
python init_database.py
```

### é—®é¢˜4ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ
**ç­”æ¡ˆ**ï¼š
1. æ£€æŸ¥.envæ–‡ä»¶ä¸­çš„DATABASE_URL
2. ç¡®ä¿æœ‰å†™å…¥æƒé™
3. æ£€æŸ¥SQLAlchemyæ˜¯å¦æ­£ç¡®å®‰è£…

---

**ğŸ‰ æ­å–œï¼ä½ å·²ç»æˆåŠŸè®¾è®¡å’Œåˆ›å»ºäº†é¡¹ç›®æ•°æ®åº“ï¼**

**ä¸‹ä¸€ä¸ªæ–‡æ¡£ï¼š** `APIæ¥å£å¼€å‘æŒ‡å—.md`